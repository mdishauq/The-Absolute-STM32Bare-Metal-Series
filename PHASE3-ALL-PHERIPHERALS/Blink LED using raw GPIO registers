#include <stdint.h>

// RCC base address      = 0x40021000
// GPIOC base address    = 0x40011000

#define RCC_APB2ENR  (*(volatile uint32_t*)0x40021018)
#define GPIOC_CRH    (*(volatile uint32_t*)0x40011004)
#define GPIOC_ODR    (*(volatile uint32_t*)0x4001100C)

void delay(volatile uint32_t);


void delay(volatile uint32_t a)
{
    while(a--) {
        __asm("nop");
    }
}

int main(void)
{
    // 1. Enable GPIOC clock (bit 4)
    RCC_APB2ENR |= (1 << 4);

    // 2. Configure PC13 as output
    // Clear CNF13[1:0] and MODE13[1:0]
    GPIOC_CRH &= ~(uint32_t)(0xF << 20);

    // Set MODE13 = 0b10 (Output 2 MHz), CNF13 = 00 (Push-pull)
    GPIOC_CRH |= (0x2 << 20);

    while (1)
    {
        GPIOC_ODR ^= (1 << 13);  // Toggle PC13
        delay(100000
			);
    }
}
